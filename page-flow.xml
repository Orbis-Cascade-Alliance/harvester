<?xml version="1.0" encoding="utf-8"?>
<!--
    Copyright (C) 2007 Orbeon, Inc.

    This program is free software; you can redistribute it and/or modify it under the terms of the
    GNU Lesser General Public License as published by the Free Software Foundation; either version
    2.1 of the License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU Lesser General Public License for more details.

    The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
-->
<config xmlns="http://www.orbeon.com/oxf/controller" xmlns:oxf="http://www.orbeon.com/oxf/processors" matcher="regexp">
	
	
	<!-- ****************
	* PUBLIC INTERFACE *
	***************** -->
	<!-- **** PAGES **** -->			
	<page path="/harvester/documentation" model="config.xml" view="xpl/views/pages/documentation.xpl"/>
	<page path="/harvester/sparql" view="xpl/views/pages/sparql.xpl"/>
	<page path="/harvester/" model="xpl/models/sparql/index.xpl" view="xpl/views/pages/index.xpl"/>
	
	<!-- **** SERIALIZATIONS **** -->	
	<page path="/harvester/feed" model="xpl/models/sparql/atom.xpl" view="xpl/views/serializations/sparql/atom.xpl"/>
	<page path="/harvester/apis/ask" model="xpl/models/sparql/ask.xpl" view="xpl/views/apis/ask.xpl"/>
	<page path="/harvester/apis/get" view="xpl/controllers/conneg-get.xpl"/>
	<page path="/harvester/apis/count" model="xpl/models/sparql/count.xpl" view="xpl/views/apis/count.xpl"/>
	
	<!-- **** SPARQL **** -->
	<page path="/harvester/query" view="xpl/controllers/conneg-sparql.xpl"/>
	
	<!-- **** DATA DUMPS **** -->
	<page path="/harvester/download/(.*)\.rdf" view="oxf:/apps/harvester/download/${1}.rdf"/>
	<page path="/harvester/download/(.*)\.jsonld" view="xpl/controllers/serialize-json-ld.xpl"/>
	<page path="/harvester/download/(.*)\.ttl" view="xpl/controllers/serialize-ttl.xpl"/>
	
	<!-- ****************
	* ADMIN INTERFACE *
	***************** -->
	<page path="/harvester/admin/" view="xforms/admin.xhtml"/>
	<page path="/harvester/admin/import" view="xforms/import.xhtml"/>
	
	<!-- ****************
	* INGEST APIs (Under ADMIN)*
	***************** -->
	<!-- getRDF accepts the mandatory sets parameter, with multiple sets from the same repository separated by |, 
		the mandatory repository parameter which must match the main agency code, and the mandatory ark parameter.
		It will perform a check on all sets to determine whether CHOs are available -->
	<page path="/harvester/admin/check" view="xpl/controllers/check.xpl"/>
	
	<!-- getRDF accepts the mandatory sets parameter, with multiple sets from the same repository separated by |, 
		the mandatory repository parameter which must match the main agency code, and the optional ark parameter.
		It will generate transform OAI sets into RDF for view. It will not post data -->
	<page path="/harvester/admin/getRDF" view="xpl/controllers/getRDF.xpl"/>
	
	<!-- ingest accepts the mandatory sets parameter, with multiple sets from the same repository separated by |, 
		the mandatory repository parameter which must match the main agency code, and the optional ark parameter.
		It will generate transform OAI sets into RDF. It will purge existing triples associated with CHOs with SPARQL/Update and post data into the endpoint. -->
	<page path="/harvester/admin/ingest" view="xpl/controllers/ingest.xpl"/>
	
	<!-- ****************
	* DATA DUMP GENERATION*
	***************** -->
	
	<!-- pass the repository request parameter to the pipeline to load the RDF/XML and execute the transformation and serialization (into a file) of RDF/XML, TTL, or JSON-LD 
	The XForms Submissions are GET, but have no output (seralization='none'). The process is much more efficient handled in the XPL workflow than through XForms controls in the web interface -->
	<page path="/harvester/admin/generateXML" model="xpl/controllers/generate-rdfxml.xpl"/>
	<page path="/harvester/admin/generateTTL" model="xpl/controllers/generate-ttl.xpl"/>
	<page path="/harvester/admin/generateJSON" model="xpl/controllers/generate-json.xpl"/>
	
	<epilogue url="oxf:/config/epilogue.xpl"/>
</config>
